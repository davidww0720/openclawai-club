<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¦ æ„¤æ€’çš„å°é¸Ÿ - Game.OpenClaw.Cloud</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #333; }
        body { display: flex; justify-content: center; align-items: center; }
        #gameWrap { position: relative; width: 100%; height: 100%; max-width: 1200px; max-height: 100vh; }
        canvas { display: block; width: 100%; height: 100%; }
        #ui { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; pointer-events: none; }
        #scoreBox { background: rgba(0,0,0,0.7); color: #fff; padding: 8px 20px; border-radius: 20px; font: bold 20px sans-serif; }
        #levelBox { background: rgba(0,0,0,0.7); color: #fff; padding: 8px 20px; border-radius: 20px; font: bold 20px sans-serif; }
        #tip { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: #fff; padding: 10px 25px; border-radius: 25px; font: 16px sans-serif; }
        #restart { position: absolute; top: 10px; right: 10px; background: linear-gradient(90deg,#ff6b6b,#feca57); color: #fff; border: none; padding: 10px 20px; border-radius: 20px; font: bold 16px sans-serif; cursor: pointer; }
    </style>
</head>
<body>
    <div id="gameWrap">
        <canvas id="c"></canvas>
        <div id="ui">
            <div id="scoreBox">å¾—åˆ†: <span id="score">0</span></div>
            <div id="levelBox">å…³å¡: <span id="level">1</span></div>
        </div>
        <button id="restart" onclick="resetLevel()">ğŸ”„ é‡ç©</button>
        <div id="tip">ğŸ¯ æ‹–åŠ¨å°é¸Ÿå‘åæ‹‰ï¼Œæ¾å¼€å‘å°„ï¼</div>
    </div>

<script>
// Game Engine
const c = document.getElementById('c');
const ctx = c.getContext('2d');
let W, H;

// Responsive canvas
function resize() {
    const wr = document.getElementById('gameWrap');
    W = wr.clientWidth;
    H = wr.clientHeight;
    c.width = 1200;
    c.height = 700;
    c.style.width = W + 'px';
    c.style.height = H + 'px';
}
resize();
window.addEventListener('resize', resize);

const SCALE = () => 1200 / W;

// Physics constants
const GRAVITY = 0.35;
const DAMPING = 0.6;
const GROUND_Y = 600;

// Game state
let score = 0;
let level = 1;
let bird = null;
let pigs = [];
let blocks = [];
let particles = [];
let gameState = 'aiming'; // aiming, flying, waiting

// Level designs
const LEVELS = [
    // Level 1: Simple
    {
        pigs: [{x:900,y:520,r:25},{x:1000,y:520,r:22}],
        blocks: [
            {x:850,y:550,w:20,h:100,type:'wood'},
            {x:950,y:550,w:20,h:100,type:'wood'},
            {x:900,y:480,w:120,h:15,type:'wood'}
        ]
    },
    // Level 2: Two floors
    {
        pigs: [{x:850,y:520,r:25},{x:950,y:520,r:25},{x:1050,y:420,r:20}],
        blocks: [
            {x:800,y:550,w:20,h:100,type:'wood'},
            {x:900,y:550,w:20,h:100,type:'wood'},
            {x:850,y:480,w:120,h:15,type:'wood'},
            {x:1000,y:550,w:20,h:100,type:'wood'},
            {x:1050,y:480,w:80,h:15,type:'wood'}
        ]
    },
    // Level 3: Stone fortress
    {
        pigs: [{x:900,y:520,r:25},{x:1000,y:520,r:25},{x:950,y:350,r:18}],
        blocks: [
            {x:850,y:550,w:20,h:100,type:'stone'},
            {x:950,y:550,w:20,h:100,type:'stone'},
            {x:900,y:480,w:120,h:15,type:'stone'},
            {x:850,y:430,w:15,h:80,type:'stone'},
            {x:990,y:430,w:15,h:80,type:'stone'},
            {x:900,y:380,w:120,h:15,type:'stone'}
        ]
    }
];

function loadLevel(lvl) {
    level = lvl;
    document.getElementById('level').textContent = level;
    
    const data = LEVELS[(lvl-1) % LEVELS.length];
    
    // Bird
    bird = {
        x: 200, y: 500, r: 20,
        vx: 0, vy: 0,
        startX: 200, startY: 500,
        dragging: false,
        rotation: 0
    };
    
    // Scale positions
    const sx = 1200 / 1200;
    const sy = 700 / 700;
    
    pigs = data.pigs.map(p => ({...p, alive: true, hp: 3}));
    blocks = data.blocks.map(b => ({...b, alive: true, hp: b.type==='stone' ? 5 : 2}));
    particles = [];
    gameState = 'aiming';
}

function resetLevel() {
    loadLevel(level);
}

// Drawing functions
function drawSky() {
    const g = ctx.createLinearGradient(0,0,0,700);
    g.addColorStop(0, '#87CEEB');
    g.addColorStop(0.7, '#E0F6FF');
    g.addColorStop(0.7, '#87CEEB');
    g.addColorStop(1, '#228B22');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,1200,700);
}

function drawSlingshot() {
    ctx.fillStyle = '#654321';
    ctx.fillRect(130, 450, 15, 150);
    ctx.fillRect(100, 580, 80, 20);
    
    // Rubber band
    if (bird.dragging) {
        ctx.strokeStyle = '#8B0000';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(138, 470);
        ctx.lineTo(bird.x, bird.y);
        ctx.stroke();
    }
}

function drawBird() {
    ctx.save();
    ctx.translate(bird.x, bird.y);
    if (gameState === 'flying') {
        bird.rotation += 0.15;
        ctx.rotate(bird.rotation);
    }
    
    // Body
    ctx.fillStyle = '#e74c3c';
    ctx.beginPath();
    ctx.arc(0, 0, bird.r, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = '#c0392b';
    ctx.lineWidth = 2;
    ctx.stroke();
    
    // Belly
    ctx.fillStyle = '#f39c12';
    ctx.beginPath();
    ctx.arc(0, 5, 12, 0, Math.PI*2);
    ctx.fill();
    
    // Eye
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(8, -5, 8, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.arc(10, -5, 4, 0, Math.PI*2);
    ctx.fill();
    
    // Eyebrow
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(2, -12);
    ctx.lineTo(15, -8);
    ctx.stroke();
    
    // Beak
    ctx.fillStyle = '#f1c40f';
    ctx.beginPath();
    ctx.moveTo(15, 0);
    ctx.lineTo(28, 5);
    ctx.lineTo(15, 10);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = '#e67e22';
    ctx.lineWidth = 1;
    ctx.stroke();
    
    // Tail
    ctx.fillStyle = '#2c3e50';
    ctx.beginPath();
    ctx.moveTo(-18, -5);
    ctx.lineTo(-30, -15);
    ctx.lineTo(-30, 5);
    ctx.closePath();
    ctx.fill();
    
    ctx.restore();
}

function drawPig() {
    pigs.forEach(p => {
        if (!p.alive) return;
        ctx.save();
        ctx.translate(p.x, p.y);
        
        // Body
        ctx.fillStyle = '#2ecc71';
        ctx.beginPath();
        ctx.arc(0, 0, p.r, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = '#27ae60';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Snout
        ctx.fillStyle = '#82e0aa';
        ctx.beginPath();
        ctx.ellipse(0, 8, 10, 7, 0, 0, Math.PI*2);
        ctx.fill();
        
        // Nostrils
        ctx.fillStyle = '#27ae60';
        ctx.beginPath();
        ctx.arc(-4, 8, 3, 0, Math.PI*2);
        ctx.arc(4, 8, 3, 0, Math.PI*2);
        ctx.fill();
        
        // Eyes
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(-7, -5, 6, 0, Math.PI*2);
        ctx.arc(7, -5, 6, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(-5, -5, 3, 0, Math.PI*2);
        ctx.arc(9, -5, 3, 0, Math.PI*2);
        ctx.fill();
        
        // Angry eyebrows
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(-12, -12);
        ctx.lineTo(-3, -10);
        ctx.moveTo(12, -12);
        ctx.lineTo(3, -10);
        ctx.stroke();
        
        ctx.restore();
    });
}

function drawBlock() {
    blocks.forEach(b => {
        if (!b.alive) return;
        ctx.fillStyle = b.type === 'stone' ? '#95a5a6' : '#d35400';
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.strokeStyle = b.type === 'stone' ? '#7f8c8d' : '#a04000';
        ctx.lineWidth = 2;
        ctx.strokeRect(b.x, b.y, b.w, b.h);
        
        // Wood grain
        if (b.type === 'wood') {
            ctx.strokeStyle = '#a04000';
            ctx.lineWidth = 1;
            for(let i=0; i<3; i++) {
                ctx.beginPath();
                ctx.moveTo(b.x + 3, b.y + (b.h/4)*(i+1));
                ctx.lineTo(b.x + b.w - 3, b.y + (b.h/4)*(i+1));
                ctx.stroke();
            }
        }
    });
}

function drawParticles() {
    particles.forEach((p, i) => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.2;
        p.life -= 0.02;
        if (p.life <= 0) {
            particles.splice(i, 1);
            return;
        }
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fill();
        ctx.globalAlpha = 1;
    });
}

function createParticles(x, y, color, count) {
    for (let i = 0; i < count; i++) {
        particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 10,
            vy: (Math.random() - 0.5) * 10,
            size: Math.random() * 5 + 2,
            color,
            life: 1
        });
    }
}

// Physics
function update() {
    if (gameState === 'flying') {
        bird.vy += GRAVITY;
        bird.x += bird.vx;
        bird.y += bird.vy;
        
        // Ground collision
        if (bird.y + bird.r > GROUND_Y) {
            bird.y = GROUND_Y - bird.r;
            bird.vy = -bird.vy * DAMPING;
            bird.vx *= 0.8;
            if (Math.abs(bird.vy) < 1) {
                bird.vy = 0;
                bird.vx = 0;
                setTimeout(() => {
                    if (pigs.some(p => p.alive)) {
                        resetLevel();
                    } else {
                        level++;
                        loadLevel(level);
                    }
                }, 1500);
            }
        }
        
        // Wall collision
        if (bird.x < bird.r || bird.x > 1200 - bird.r) {
            bird.vx *= -0.7;
            bird.x = bird.x < bird.r ? bird.r : 1200 - bird.r;
        }
        
        // Block collision
        blocks.forEach(b => {
            if (!b.alive) return;
            if (bird.x + bird.r > b.x && bird.x - bird.r < b.x + b.w &&
                bird.y + bird.r > b.y && bird.y - bird.r < b.y + b.h) {
                
                // Simple bounce
                const cx = b.x + b.w/2;
                const cy = b.y + b.h/2;
                if (Math.abs(bird.x - cx) > Math.abs(bird.y - cy)) {
                    bird.vx *= -0.7;
                } else {
                    bird.vy *= -0.7;
                }
                
                b.hp--;
                if (b.hp <= 0) {
                    b.alive = false;
                    createParticles(b.x + b.w/2, b.y + b.h/2, b.type==='stone'?'#95a5a6':'#d35400', 15);
                }
            }
        });
        
        // Pig collision
        pigs.forEach(p => {
            if (!p.alive) return;
            const dx = bird.x - p.x;
            const dy = bird.y - p.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist < bird.r + p.r) {
                p.alive = false;
                score += 500;
                document.getElementById('score').textContent = score;
                createParticles(p.x, p.y, '#2ecc71', 20);
                bird.vx *= 0.5;
                bird.vy *= 0.5;
            }
        });
    }
}

function draw() {
    ctx.clearRect(0, 0, 1200, 700);
    drawSky();
    drawBlock();
    drawPig();
    drawSlingshot();
    drawBird();
    drawParticles();
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

// Input handling
function getPos(e) {
    const rect = c.getBoundingClientRect();
    const sx = 1200 / rect.width;
    const sy = 700 / rect.height;
    let x, y;
    if (e.touches) {
        x = e.touches[0].clientX;
        y = e.touches[0].clientY;
    } else {
        x = e.clientX;
        y = e.clientY;
    }
    return { x: (x - rect.left) * sx, y: (y - rect.top) * sy };
}

function handleStart(e) {
    e.preventDefault();
    if (gameState !== 'aiming') return;
    const p = getPos(e);
    const dx = p.x - bird.x;
    const dy = p.y - bird.y;
    if (Math.sqrt(dx*dx + dy*dy) < bird.r + 30) {
        bird.dragging = true;
    }
}

function handleMove(e) {
    e.preventDefault();
    if (!bird.dragging) return;
    const p = getPos(e);
    
    const maxDrag = 100;
    let dx = p.x - bird.startX;
    let dy = p.y - bird.startY;
    const dist = Math.sqrt(dx*dx + dy*dy);
    
    if (dist > maxDrag) {
        const angle = Math.atan2(dy, dx);
        dx = Math.cos(angle) * maxDrag;
        dy = Math.sin(angle) * maxDrag;
    }
    
    bird.x = bird.startX + dx;
    bird.y = bird.startY + dy;
}

function handleEnd(e) {
    e.preventDefault();
    if (!bird.dragging) return;
    bird.dragging = false;
    bird.vx = (bird.startX - bird.x) * 0.18;
    bird.vy = (bird.startY - bird.y) * 0.18;
    gameState = 'flying';
}

c.addEventListener('mousedown', handleStart);
c.addEventListener('mousemove', handleMove);
c.addEventListener('mouseup', handleEnd);
c.addEventListener('mouseleave', handleEnd);

c.addEventListener('touchstart', handleStart, {passive: false});
c.addEventListener('touchmove', handleMove, {passive: false});
c.addEventListener('touchend', handleEnd, {passive: false});

// Start game
loadLevel(1);
loop();
</script>
</body>
</html>
